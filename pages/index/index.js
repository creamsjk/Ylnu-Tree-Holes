(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"25ab":function(t,e,r){"use strict";(function(t){r("34c8");n(r("66fd"));var e=n(r("4df1"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=r,t(e.default)}).call(this,r("543d")["createPage"])},3155:function(t,e,r){},"4df1":function(t,e,r){"use strict";r.r(e);var n=r("c48d"),a=r("f270");for(var i in a)"default"!==i&&function(t){r.d(e,t,(function(){return a[t]}))}(i);r("5b99");var o,s=r("f0c5"),c=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);e["default"]=c.exports},"5b99":function(t,e,r){"use strict";var n=r("3155"),a=r.n(n);a.a},"97f7":function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(r("a34a"));r("89b8");r("6ee4"),o(r("2726"));var a=r("89b8");function i(){if("function"!==typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var e=i();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var o=n?Object.getOwnPropertyDescriptor(t,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=t[a]}return r.default=t,e&&e.set(t,r),r}function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function d(t,e){var r;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=f(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,i=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw i}}}}function f(t,e){if(t){if("string"===typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function g(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function m(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){g(i,n,a,o,s,"next",t)}function s(t){g(i,n,a,o,s,"throw",t)}o(void 0)}))}}var v={data:function(){return{checked:!1,loading:!0,phone_info:[],flavorNotify:!1,wh:0,scrollTop:0,active:0,icon:{active:"../images/order.png",inactive:"https://img01.yzcdn.cn/vant/user-inactive.png"},QiNiuYunUrl:getApp().globalData.QiNiuYunUrl,activeType:0,categoryList:[],categoryId:void 0,dishList:[],cartData:[],dialogFlavor:{name:"",flavors:[],dishId:void 0,price:void 0,show:!1,image:""},cartDialogShow:!1,detailsDialog:{show:!1,item:{image:""}},setMealDialog:{show:!1,item:{}}}},components:{},onShow:function(){this.initData();var t=wx.getStorageSync("token");console.log("token",t),0==t.length&&(this.cartData=[]),this.activeType=0,this.dialogFlavor.show=!1},computed:{goodsNum:function(){var t=0;return this.cartData.forEach((function(e){t+=e.number})),t<99?t:"99+"},goodsPrice:function(){var t=0;return this.cartData.forEach((function(e){t+=e.number*e.amount})),t.toFixed(2)}},onReady:function(){},created:function(){},watch:{},mounted:function(){var e=t.getSystemInfoSync();this.wh=e.windowHeight,this.cartData=[],this.initData()},methods:{cartclose:function(){this.cartDialogShow=!1},dishclose:function(){this.detailsDialog.show=!1},setMealclose:function(){this.setMealDialog.show=!1},flavorclose:function(){this.dialogFlavor.show=!1},initData:function(){var e=this;return m(n.default.mark((function r(){return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:Promise.all([(0,a.categoryListApi)(),(0,a.cartListApi)({})]).then((function(r){if(console.log("菜单列表",r),0!==r[0].code)return t.$showMsg();e.categoryList=r[0].data,Array.isArray(r[0].data)&&r[0].data.length>0&&(e.categoryId=r[0].data[0].id,1===r[0].data[0].type?e.getDishList():e.getSetmealData()),0===r[1].code&&(e.cartData=r[1].data),e.loading&&setTimeout((function(){e.loading=!1}),1500)}));case 1:case"end":return r.stop()}}),r)})))()},categoryClick:function(t,e,r){this.scrollTop=0===this.scrollTop?1:0,this.activeType=t,this.categoryId=e,1===r?this.getDishList():this.getSetmealData()},getDishList:function(){var e=this;return m(n.default.mark((function r(){var i,o,s;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.categoryId){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,(0,a.dishListApi)({categoryId:e.categoryId,status:1});case 4:if(i=r.sent,0!==i.code){r.next=12;break}o=i.data,s=e.cartData,o.length>0&&s.length>0&&o.forEach((function(t){s.forEach((function(e){t.id===e.dishId&&(t.number=e.number)}))})),e.dishList=o,r.next=13;break;case 12:return r.abrupt("return",t.$showMsg());case 13:case"end":return r.stop()}}),r)})))()},getSetmealData:function(){var e=this;return m(n.default.mark((function r(){var i,o,s;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.categoryId){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,(0,a.setmealListApi)({categoryId:e.categoryId,status:1});case 4:if(i=r.sent,0!==i.code){r.next=12;break}o=i.data,s=e.cartData,o.length>0&&s.length>0&&o.forEach((function(t){s.forEach((function(e){t.id===e.setmealId&&(t.number=e.number)}))})),e.dishList=o,r.next=13;break;case 12:return r.abrupt("return",t.$showMsg());case 13:case"end":return r.stop()}}),r)})))()},getCartData:function(){var e=this;return m(n.default.mark((function r(){var i;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,a.cartListApi)({});case 2:if(i=r.sent,0!==i.code){r.next=7;break}e.cartData=i.data,r.next=9;break;case 7:return console.log("-----------获取购物车失败-----------"),r.abrupt("return",t.$showMsg());case 9:case"end":return r.stop()}}),r)})))()},addCart:function(e){var r=this;return m(n.default.mark((function i(){var o,s,c;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.getStorageSync("token"),!o){n.next=16;break}return s={amount:e.price/100,dishFlavor:e.dishFlavor,dishId:void 0,setmealId:void 0,name:e.name,image:e.image},Array.isArray(e.flavors)?s.dishId=e.id:s.setmealId=e.id,n.next=6,(0,a.addCartApi)(s);case 6:if(c=n.sent,0!==c.code){n.next=13;break}r.dishList.forEach((function(t){t.id===e.id&&(console.log("数量={}",c.data.number),t.number=c.data.number)})),r.setMealDialog.show&&(console.log(c.data.number),e.number=c.data.number),r.getCartData(),n.next=14;break;case 13:return n.abrupt("return",t.$showMsg());case 14:n.next=17;break;case 16:t.showModal({title:"提示",content:"请登录",success:function(e){e.confirm?t.switchTab({url:"/pages/my/my"}):e.cancel&&console.log("用户点击取消")}});case 17:case"end":return n.stop()}}),i)})))()},subtractCart:function(e){var r=this;return m(n.default.mark((function i(){var o,s,c;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.getStorageSync("token"),o){n.next=4;break}return t.showModal({title:"提示",content:"请登录",success:function(e){e.confirm?t.switchTab({url:"/pages/my/my"}):e.cancel&&console.log("用户点击取消")}}),n.abrupt("return");case 4:return s={dishId:e.id},Array.isArray(e.flavors)||(s={setmealId:e.id}),n.next=8,(0,a.updateCartApi)(s);case 8:if(c=n.sent,0!==c.code){n.next=15;break}r.dishList.forEach((function(t){t.id===e.id&&(t.number=0===c.data.number?void 0:c.data.number)})),r.setMealDialog.show&&(e.number=0===c.data.number?void 0:c.data.number),r.getCartData(),n.next=17;break;case 15:return n.abrupt("return",t.$showMsg());case 17:case"end":return n.stop()}}),i)})))()},openCart:function(){this.cartData.length>0&&(this.cartDialogShow=!0)},cartNumAdd:function(e){var r=this;return m(n.default.mark((function i(){var o,s,c;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.getStorageSync("token"),!o){n.next=15;break}return s={amount:e.amount,dishFlavor:e.dishFlavor,dishId:e.dishId,setmealId:e.setmealId,name:e.name,image:e.image},n.next=5,(0,a.addCartApi)(s);case 5:if(c=n.sent,0!==c.code){n.next=12;break}r.dishList.forEach((function(t){t.id===(e.dishId||e.setmealId)&&(t.number=c.data.number)})),console.log(r.dishList),r.getCartData(),n.next=13;break;case 12:return n.abrupt("return",t.$showMsg());case 13:n.next=16;break;case 15:t.showModal({title:"提示",content:"请登录",success:function(e){e.confirm?t.switchTab({url:"/pages/my/my"}):e.cancel&&console.log("用户点击取消")}});case 16:case"end":return n.stop()}}),i)})))()},cartNumberSubtract:function(e){var r=this;return m(n.default.mark((function i(){var o,s;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o={dishId:e.dishId,setmealId:e.setmealId},n.next=3,(0,a.updateCartApi)(o);case 3:if(s=n.sent,0!==s.code){n.next=9;break}r.dishList.forEach((function(t){t.id===(e.dishId||e.setmealId)&&(t.number=0===s.data.number?void 0:s.data.number)})),r.getCartData(),n.next=10;break;case 9:return n.abrupt("return",t.$showMsg());case 10:case"end":return n.stop()}}),i)})))()},changeDishList:function(t){var e,r=d(this.dishList);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.id===(t.setmealId||t.dishId)&&(n.number=t.number)}}catch(a){r.e(a)}finally{r.f()}},clearCart:function(){var e=this;return m(n.default.mark((function r(){var i,o,s,c;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,a.clearCartApi)();case 2:if(i=r.sent,0!==i.code){r.next=10;break}o=d(e.dishList);try{for(o.s();!(s=o.n()).done;)c=s.value,c.number=void 0}catch(n){o.e(n)}finally{o.f()}e.cartData=[],e.cartDialogShow=!1,r.next=11;break;case 10:return r.abrupt("return",t.$showMsg());case 11:case"end":return r.stop()}}),r)})))()},chooseFlavorClick:function(t){this.detailsDialog.show=!1,this.dialogFlavor={name:"",flavors:[],dishId:void 0,price:void 0,show:!1},this.dialogFlavor={name:t.name,flavors:t.flavors,dishId:t.id,price:t.price,show:!0,image:t.image},console.log("口味",this.dialogFlavor.flavors)},flavorClick:function(t,e){console.log("index",t),this.dialogFlavor.flavors[t].dishFlavor=e,this.dialogFlavor.show=!1,this.dialogFlavor.show=!0},dialogFlavorAddCart:function(){var e=this.dialogFlavor,r=!0,n=[];e.flavors.forEach((function(e){console.log("选择口味加入购物车",e),e.dishFlavor?n.push(e.dishFlavor):(r=!1,console.log("请添加口味"),t.showToast({title:"请选择"+e.name,icon:"error"}))})),r&&(this.addCart({price:e.price,dishFlavor:n.join(","),id:e.dishId,flavors:[],image:e.image,name:e.name}),this.dialogFlavor.show=!1)},imgPathConvert:function(t){return this.QiNiuYunUrl+t},toAddOrderPage:function(){var e=t.getStorageSync("token");e?this.cartData.length>0&&t.navigateTo({url:"/pages/addOrder/addOrder"}):t.showModal({title:"提示",content:"请登录",success:function(e){e.confirm?t.switchTab({url:"/pages/my/my"}):e.cancel&&console.log("用户点击取消")}})},toUserPage:function(){window.requestAnimationFrame((function(){window.location.href="/front/page/user.html"}))},dishDetails:function(e){var r=this;return m(n.default.mark((function i(){var o;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.detailsDialog.item={},r.setMealDialog.item={},!Array.isArray(e.flavors)){n.next=7;break}r.detailsDialog.item=e,r.detailsDialog.show=!0,n.next=16;break;case 7:return n.next=9,(0,a.setMealDishDetailsApi)(e.id);case 9:if(o=n.sent,0!==o.code){n.next=15;break}r.setMealDialog.item=u(u({},e),{},{list:o.data}),r.setMealDialog.show=!0,n.next=16;break;case 15:return n.abrupt("return",t.$showMsg());case 16:case"end":return n.stop()}}),i)})))()}}};e.default=v}).call(this,r("543d")["default"])},c48d:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return n}));var n={uImage:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uview-ui/components/u-image/u-image")]).then(r.bind(null,"5a38"))},uPopup:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(r.bind(null,"fc83"))},uNotify:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uview-ui/components/u-notify/u-notify")]).then(r.bind(null,"de83"))}},a=function(){var t=this,e=t.$createElement,r=(t._self._c,t.__map(t.dishList,(function(e,r){var n=t.__get_orig(e),a=t.imgPathConvert(e.image);return{$orig:n,m0:a}}))),n=t.__map(t.dialogFlavor.flavors,(function(e,r){var n=t.__get_orig(e),a=JSON.parse(e.value);return{$orig:n,l1:a}})),a=t.__map(t.cartData,(function(e,r){var n=t.__get_orig(e),a=t.imgPathConvert(e.image);return{$orig:n,m1:a}})),i=t.detailsDialog.show?t.imgPathConvert(t.detailsDialog.item.image):null,o=t.setMealDialog.show?t.__map(t.setMealDialog.item.list,(function(e,r){var n=t.__get_orig(e),a=t.imgPathConvert(e.image);return{$orig:n,m3:a}})):null;t._isMounted||(t.e0=function(e,r,n){var a=arguments[arguments.length-1].currentTarget.dataset,i=a.eventParams||a["event-params"];r=i.index,n=i.item;return t.flavorClick(r,n)}),t.$mp.data=Object.assign({},{$root:{l0:r,l2:n,l3:a,m2:i,l4:o}})},i=[]},f270:function(t,e,r){"use strict";r.r(e);var n=r("97f7"),a=r.n(n);for(var i in n)"default"!==i&&function(t){r.d(e,t,(function(){return n[t]}))}(i);e["default"]=a.a}},[["25ab","common/runtime","common/vendor"]]]);